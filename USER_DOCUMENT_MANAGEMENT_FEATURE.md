# 用户文档管理功能

## 功能概述

现在系统支持用户上传和管理各种职业相关文档（简历、劳动合同、Offer、在职情况等），并通过AI自动提取结构化信息，用于生成个性化的思维导图、技能树、流程图等可视化内容。

## 实现的功能

### 1. 数据库层面
- ✅ 创建了 `user_documents` 表，支持多种文档类型
- ✅ 支持文档元数据存储（文件名、大小、类型、路径等）
- ✅ 支持AI提取的结构化信息存储
- ✅ 支持文档处理状态跟踪
- ✅ 添加了默认用户档案（default-user）

### 2. 后端API层面
- ✅ 完整的文档CRUD操作API
- ✅ 文档上传和文件管理
- ✅ AI文档信息提取功能
- ✅ 可视化数据生成功能
- ✅ 完整的错误处理和日志记录

### 3. AI文档提取功能
- ✅ 支持简历信息提取（个人信息、工作经历、教育背景、技能等）
- ✅ 支持合同信息提取（公司、职位、薪资、福利、风险条款等）
- ✅ 支持Offer信息提取（薪资、福利、工作条件等）
- ✅ 支持在职情况提取（职责、成就、技能使用等）
- ✅ 支持通用文档信息提取

### 4. 可视化数据生成
- ✅ 简历技能树生成
- ✅ 职业时间线生成
- ✅ 思维导图数据生成
- ✅ 合同风险分析
- ✅ Offer对比分析
- ✅ 职业发展路径规划

## API接口详情

### 文档管理接口

#### 获取用户文档列表
```http
GET /api/users/{userId}/documents?documentType={type}&limit={limit}&offset={offset}
```

#### 上传文档
```http
POST /api/users/{userId}/documents
Content-Type: multipart/form-data

documentType: resume|contract|offer|employment|other
file: [文件]
```

#### 获取单个文档
```http
GET /api/users/{userId}/documents/{documentId}
```

#### 删除文档
```http
DELETE /api/users/{userId}/documents/{documentId}
```

#### 处理文档（AI提取）
```http
POST /api/users/{userId}/documents/{documentId}/process
```

#### 获取提取信息
```http
GET /api/users/{userId}/documents/{documentId}/extracted-info
```

#### 生成可视化数据
```http
GET /api/users/{userId}/documents/{documentId}/visualization
```

## 支持的文档类型

### 1. 简历 (resume)
- **个人信息**：姓名、邮箱、电话、地址、LinkedIn、GitHub
- **工作经历**：公司、职位、时间、描述、技能
- **教育背景**：学校、学位、专业、时间、GPA
- **技能**：技术技能、软技能、语言、证书

### 2. 劳动合同 (contract)
- **基本信息**：公司名称、职位、薪资、入职日期
- **工作条件**：工作地点、工作时间、合同类型
- **福利待遇**：各种福利项目
- **风险条款**：竞业限制、保密条款、离职通知期

### 3. Offer (offer)
- **薪资待遇**：基本工资、奖金、股权
- **工作条件**：工作地点、工作时间、汇报对象
- **福利待遇**：各种福利项目
- **团队信息**：团队规模、部门信息

### 4. 在职情况 (employment)
- **工作职责**：具体工作内容
- **主要成就**：工作成果和成就
- **技能使用**：工作中使用的技能
- **项目经验**：参与的项目

## 可视化内容生成

### 简历可视化
- **技能树**：技术技能、软技能分类展示
- **时间线**：工作经历时间线
- **思维导图**：个人信息、经历、技能的整体展示

### 合同可视化
- **风险分析**：合同风险点识别和分析
- **流程图**：合同签署到入职的流程

### Offer可视化
- **对比分析**：不同Offer的对比
- **决策流程**：Offer决策流程图

### 在职情况可视化
- **职业发展路径**：当前职位到目标职位的路径
- **技能发展图**：技能现状和目标

## 技术特点

- 🔒 **数据安全**：用户文档完全私有化存储
- 🤖 **AI智能提取**：自动提取文档关键信息
- 📊 **可视化生成**：基于提取信息生成多种可视化内容
- 🔄 **异步处理**：文档处理采用异步方式，不阻塞用户操作
- 📁 **文件管理**：完整的文件上传、存储、删除管理
- 🏷️ **分类管理**：支持多种文档类型分类
- 📈 **状态跟踪**：完整的处理状态跟踪和错误处理
- 🎯 **个性化**：基于用户文档生成个性化内容

## 使用流程

1. **上传文档**：用户选择文档类型并上传文件
2. **自动处理**：系统自动提取文件内容
3. **AI分析**：AI分析文档内容并提取结构化信息
4. **生成可视化**：基于提取信息生成可视化数据
5. **个性化应用**：用于生成思维导图、技能树、流程图等

## 数据库变更

需要在现有数据库上执行以下SQL来添加新表和默认用户：

```sql
-- 添加默认用户档案
INSERT INTO user_profiles (user_id, nickname, default_model, created_at, updated_at) VALUES 
('default-user', '默认用户', 'bailian/qwen-flash', NOW(), NOW());
```

或者重新运行 `sql/recreate_tables.sql` 脚本来重建数据库。

## 未来扩展

- 📄 **更多文档类型**：支持更多职业相关文档类型
- 🔍 **智能搜索**：基于文档内容的智能搜索
- 📈 **趋势分析**：基于历史文档的职业发展趋势分析
- 🔗 **关联分析**：不同文档之间的关联分析
- 📱 **移动端支持**：移动端文档上传和管理
- 🌐 **云端存储**：支持云端文档存储和同步

现在您的AI职场管家具备了完整的文档管理能力，可以为用户提供更加个性化和智能化的职业规划服务！🎉
